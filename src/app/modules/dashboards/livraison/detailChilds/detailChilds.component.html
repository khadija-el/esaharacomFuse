<div class="example-container mat-elevation-z4 mt-2">
   <div class="example-table-container">
    <form [formGroup]="form" autocomplete="off">
      <table mat-table #table formArrayName="dataSource" [dataSource]="dataSourceFA.controls" multiTemplateDataRows>

        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>#</th>
          <td mat-cell *matCellDef="let row; let i = dataIndex">
            <strong>ID {{i + 1}} </strong>
          </td>
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>

        <ng-container matColumnDef="article">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Article</th>
          <td mat-cell *matCellDef="let row; let i = dataIndex" [formGroup]="row">
            <app-table-auto-complete
              [options]="{ key: '', serviceName: 'articles', value: row.value.article}"
              (selectChange)="rowChange(row, $any($event))" [attr.data-test]="'idArticle-' + i" formControlName="idArticle">
            </app-table-auto-complete>

          </td>
          <td mat-footer-cell *matFooterCellDef> Total </td>
        </ng-container>

        <ng-container matColumnDef="qte">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Qte</th>
          <td mat-cell *matCellDef="let row; let i = dataIndex" [formGroup]="row">
            <mat-form-field floatLabel="auto" appearance="fill" class="mat-table-form-field">
              <input matInput placeholder="qte" [attr.data-test]="'qte-' + i" formControlName="qte" type="number" required>
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>

        <ng-container matColumnDef="prix">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>prix HT</th>
          <td mat-cell *matCellDef="let row; let i = dataIndex" [formGroup]="row">
            <mat-form-field floatLabel="auto" appearance="fill" class="mat-table-form-field">
              <input matInput placeholder="prix" [attr.data-test]="'prix-' + i" formControlName="prix" type="number" required>
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>

        <ng-container matColumnDef="montantHT">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>montant HT</th>
          <td mat-cell *matCellDef="let row; let i = dataIndex" [formGroup]="row">
            <mat-form-field floatLabel="auto" appearance="fill" class="mat-table-form-field">
              <input matInput placeholder="montantHT" [value]="row.get('montantHT').value" type="number" readonly required>
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef>
            <mat-form-field floatLabel="auto" appearance="fill" class="mat-table-form-field">
              <input matInput placeholder="total HT" [value]="totalHT" readonly>
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="montantTTC">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>montant TTC</th>
          <td mat-cell *matCellDef="let row; let i = dataIndex" [formGroup]="row">
            <mat-form-field floatLabel="auto" appearance="fill" class="mat-table-form-field">
              <input matInput placeholder="montant TTC" [value]="row.get('montantTTC').value" type="number" readonly required>
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef>
            <mat-form-field floatLabel="auto" appearance="fill" class="mat-table-form-field">
              <input matInput placeholder="total TTC" [value]="totalTTC" readonly>
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="tva">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>tva</th>
          <td mat-cell *matCellDef="let row; let i = dataIndex," [formGroup]="row">
            <mat-form-field floatLabel="auto" appearance="fill" class="mat-table-form-field">
              <input matInput placeholder="tva" [attr.data-test]="'tva-' + i" formControlName="tva" type="number" required>
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>

        <ng-container matColumnDef="option" style="flex-direction: row-reverse;">
          <th mat-header-cell *matHeaderCellDef>

            <span class="mt-2">
              <mat-slide-toggle [formControl]="isTTC">{{isTTC.value === true ? 'TTC' : 'HT'}}</mat-slide-toggle>
            </span>

          </th>
          <td mat-cell *matCellDef="let row; let i = dataIndex;">
            <div class="button-row">
              <!-- *ngIf="dataSourceFA.length > 1" -->
              <button mat-icon-button  color="warn" (click)="delete(i)">
                <mat-icon>delete_sweep</mat-icon>
              </button>
            </div>
          </td>
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumnsFiltred"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsFiltred;" (input)="rowChange(row)"></tr>
        <tr mat-footer-row *matFooterRowDef="displayedColumnsFiltred"></tr>
      </table>
    </form>

  </div>

</div>
